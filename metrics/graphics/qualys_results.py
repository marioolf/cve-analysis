import pandas as pd
import matplotlib.pyplot as plt


with open('../../scrapers_python/latest.log', 'r') as file:
    data = file.read()

entries = data.strip().split('\n\n')

qualys_results = []

for entry in entries:
    lines = entry.split('\n')
    
    if len(lines) >= 5:
        for line in lines:
            if line.startswith("Resultado de Qualys para"):
                try:
                    qualys_result = line.split(': ')[1].strip()
                    qualys_results.append(qualys_result)
                except IndexError:
                    continue


print(f'Número de resultados de Qualys extraídos: {len(qualys_results)}')

if not qualys_results:
    print("No se encontraron resultados de Qualys.")
    exit()

df = pd.DataFrame({'Qualys Result': qualys_results})

qualys_counts = df['Qualys Result'].value_counts(normalize=True) * 100

print(f'Conteo de resultados de Qualys:\n{qualys_counts}')

# gráfico de sectores
plt.figure(figsize=(12, 8))
qualys_counts.plot.pie(autopct='%1.1f%%', startangle=90, counterclock=False)
plt.title('Distribución de los resultados de Qualys')
plt.ylabel('')
plt.savefig('qualys_results_distribution_pie.png')

# gráfico de barras
plt.figure(figsize=(12, 8))
qualys_counts.plot.bar(color='skyblue')
plt.title('Distribución de los resultados de Qualys')
plt.xlabel('Resultado de Qualys')
plt.ylabel('Porcentaje (%)')
plt.xticks(rotation=0, ha='center')
plt.savefig('qualys_results_distribution_bar.png')
